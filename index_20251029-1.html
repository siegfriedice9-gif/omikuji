<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãç„¡æ–™ãŠã¿ãã˜ - ç”Ÿé§’ã®ãŠå¯º</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #f5f3f0 0%, #e8e2d9 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .password-screen { display: block; }
        .password-screen.hidden { display: none; }
        .lock-icon { font-size: 72px; margin-bottom: 20px; }
        .password-title {
            color: #8b4513;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .password-desc { color: #666; font-size: 14px; margin-bottom: 30px; }
        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 5px;
            margin-bottom: 20px;
        }
        .password-input:focus {
            outline: none;
            border-color: #8b4513;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.2);
        }
        .password-btn {
            background: linear-gradient(45deg, #d4af37, #ffd700);
            color: #8b4513;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        .password-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }
        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        .error-message.show { display: block; }
        .omikuji-screen { display: none; }
        .omikuji-screen.active { display: block; }
        .temple-header { margin-bottom: 30px; }
        .temple-title {
            color: #8b4513;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .temple-subtitle { color: #666; font-size: 14px; }
        .instructions {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        .omikuji-box {
            background: linear-gradient(135deg, #8b4513 0%, #a0541a 100%);
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 30px;
        }
        .omikuji-button {
            background: linear-gradient(45deg, #d4af37, #ffd700);
            color: #8b4513;
            border: none;
            padding: 18px 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease;
        }
        .omikuji-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.6);
        }
        .omikuji-button:disabled { opacity: 0.6; cursor: not-allowed; }
        .result-section {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        .result-card {
            background: linear-gradient(135deg, #fff 0%, #f8f6f3 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            display: none;
            animation: fadeInScale 0.6s ease-out;
        }
        .result-card.show { display: block; }
        .result-number {
            font-size: 18px;
            color: #8b4513;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .result-fortune {
            font-size: 36px;
            font-weight: bold;
            color: #8b4513;
            margin-bottom: 15px;
        }
        .result-fortune.rare {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .result-message {
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        .reset-btn {
            background: #8b4513;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .reset-btn:hover {
            background: #a0541a;
            transform: translateY(-2px);
        }
        .qr-generator {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #d4af37;
        }
        .qr-generator-title {
            color: #8b4513;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .qr-settings {
            text-align: left;
            margin-bottom: 20px;
        }
        .qr-setting-group { margin-bottom: 15px; }
        .qr-label {
            display: block;
            color: #8b4513;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .qr-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #d4af37;
            border-radius: 5px;
            font-size: 14px;
        }
        .qr-input:focus { outline: none; border-color: #8b4513; }
        .qr-generate-btn {
            background: linear-gradient(45deg, #8b4513, #a0541a);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .qr-generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        .qr-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        .qr-result.show { display: block; }
        .qr-image-container {
            margin: 20px 0;
            padding: 15px;
            background: #f8f6f3;
            border-radius: 10px;
        }
        .qr-image-container img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .qr-details {
            background: #f8f6f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: left;
            font-size: 13px;
            color: #666;
            line-height: 1.8;
        }
        .qr-details strong { color: #8b4513; }
        .qr-url-display {
            background: #fff9e6;
            padding: 10px;
            border-radius: 5px;
            border: 1px dashed #d4af37;
            word-break: break-all;
            font-size: 12px;
            color: #666;
            margin: 10px 0;
        }
        .qr-action-btns {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .qr-action-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        .qr-action-btn:hover {
            background: #45b8b0;
            transform: translateY(-2px);
        }
        .qr-action-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        }
        .qr-action-btn.primary:hover {
            background: linear-gradient(45deg, #ff5252, #ff7575);
        }
        .qr-info {
            background: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d4af37;
            font-size: 12px;
            color: #666;
            text-align: left;
            line-height: 1.6;
            margin-top: 15px;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            border-left: 4px solid #28a745;
            display: none;
        }
        .success-message.show { display: block; }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .spinning { animation: spin 1s ease-in-out; }
        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="passwordScreen" class="password-screen">
            <div class="lock-icon">ğŸ”’</div>
            <h1 class="password-title">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›</h1>
            <p class="password-desc">ã“ã®ãŠã¿ãã˜ã¯æª€å®¶æ§˜å°‚ç”¨ã§ã™<br>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            <input type="password" id="passwordInput" class="password-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" maxlength="10">
            <button class="password-btn" onclick="checkPassword()">ğŸ”“ ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div id="errorMessage" class="error-message">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™</div>
        </div>

        <div id="omikujiScreen" class="omikuji-screen">
            <div class="temple-header">
                <h1 class="temple-title">ğŸ‹ ç„¡æ–™ãŠã¿ãã˜</h1>
                <p class="temple-subtitle">ç”Ÿé§’ã®ãŠå¯ºï¼ˆæª€å®¶æ§˜å°‚ç”¨ï¼‰</p>
            </div>
            
            <div class="instructions">
                <p>ğŸ“± ä½•åº¦ã§ã‚‚ç„¡æ–™ã§ãŠå¼•ãã„ãŸã ã‘ã¾ã™<br>å¿ƒã‚’è½ã¡ç€ã‘ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
            </div>
            
            <div class="omikuji-box">
                <button class="omikuji-button" id="drawBtn" onclick="drawOmikuji()">
                    ğŸ‹ ãŠã¿ãã˜ã‚’å¼•ã
                </button>
            </div>
            
            <div class="result-section">
                <div class="result-card" id="resultCard">
                    <div class="result-number" id="resultNumber">ç¬¬â—‹ç•ª</div>
                    <div class="result-fortune" id="resultFortune">å¤§å‰</div>
                    <div class="result-message" id="resultMessage">é‹å‹¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed #d4af37;">
                        <button class="reset-btn" onclick="resetOmikuji()">ã‚‚ã†ä¸€åº¦å¼•ã</button>
                    </div>
                </div>
            </div>

            <div class="qr-generator">
                <h2 class="qr-generator-title">ğŸ“± QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆç®¡ç†è€…ç”¨ï¼‰</h2>
                
                <div class="qr-settings">
                    <div class="qr-setting-group">
                        <label class="qr-label">ãŠã¿ãã˜ãƒšãƒ¼ã‚¸URL:</label>
                        <input type="text" id="qrUrl" class="qr-input" placeholder="https://ã‚ãªãŸã®ã‚µã‚¤ãƒˆ.com/omikuji.html" value="https://example.com/omikuji.html">
                    </div>
                    
                    <div class="qr-setting-group">
                        <label class="qr-label">è¨­å®šã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                        <input type="text" id="qrPassword" class="qr-input" placeholder="ä¾‹: danka2024" value="1234">
                    </div>

                    <div class="qr-setting-group">
                        <label class="qr-label">å¯ºé™¢åï¼ˆè¡¨ç¤ºç”¨ï¼‰:</label>
                        <input type="text" id="templeName" class="qr-input" value="ç”Ÿé§’ã®ãŠå¯º">
                    </div>
                </div>
                
                <button class="qr-generate-btn" onclick="generateQR()">ğŸ” QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
                
                <div id="qrResult" class="qr-result">
                    <div id="successMessage" class="success-message">
                        âœ… QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼
                    </div>
                    
                    <div class="qr-image-container">
                        <img id="qrImage" alt="QRã‚³ãƒ¼ãƒ‰">
                    </div>
                    
                    <div class="qr-details">
                        <strong>ğŸ“‹ ç”Ÿæˆã•ã‚ŒãŸQRã‚³ãƒ¼ãƒ‰æƒ…å ±ï¼š</strong><br>
                        å¯ºé™¢å: <span id="displayTempleName"></span><br>
                        ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <span id="displayPassword"></span><br><br>
                        <strong>å®Œå…¨ãªURL:</strong>
                    </div>
                    <div class="qr-url-display" id="displayUrl"></div>
                    
                    <div class="qr-action-btns">
                        <button class="qr-action-btn primary" onclick="downloadQR()">
                            ğŸ“¥ QRã‚³ãƒ¼ãƒ‰ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                        <button class="qr-action-btn" onclick="copyUrl()">
                            ğŸ“‹ URLã‚’ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>

                <div class="qr-info">
                    <strong>ğŸ’¡ ä½¿ã„æ–¹ï¼š</strong><br>
                    1. ä¸Šè¨˜ã®é …ç›®ã‚’å…¥åŠ›<br>
                    2. ã€ŒQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                    3. QRã‚³ãƒ¼ãƒ‰ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¾ã™<br>
                    4. ã€ŒQRã‚³ãƒ¼ãƒ‰ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                    5. ã¾ãŸã¯ç”»åƒã‚’å³ã‚¯ãƒªãƒƒã‚¯â†’ã€Œåå‰ã‚’ä»˜ã‘ã¦ç”»åƒã‚’ä¿å­˜ã€<br>
                    6. å°åˆ·ã—ã¦å¢ƒå†…ã«è¨­ç½®<br><br>
                    <strong>â€» QRã‚³ãƒ¼ãƒ‰ã«ã¯è‡ªå‹•çš„ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æƒ…å ±ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¾ã™</strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        let correctPassword = '1234';
        let generatedQrUrl = '';

        const omikujiResults = {
            normal: [
                { number: 1, fortune: "å¤§å‰", message: "ç´ æ™´ã‚‰ã—ã„ä¸€æ—¥ã¨ãªã‚‹ã§ã—ã‚‡ã†" },
                { number: 2, fortune: "ä¸­å‰", message: "è‰¯ã„ã”ç¸ã«æµã¾ã‚Œã¾ã™" },
                { number: 3, fortune: "å°å‰", message: "å°ã•ãªå¹¸ã›ãŒè¨ªã‚Œã¾ã™" },
                { number: 4, fortune: "å‰", message: "ç©ã‚„ã‹ãªæ—¥ã€…ãŒç¶šãã¾ã™" },
                { number: 5, fortune: "åŠå‰", message: "åŠªåŠ›ãŒå®Ÿã‚’çµã¶ã§ã—ã‚‡ã†" },
                { number: 6, fortune: "æœ«å‰", message: "å¾Œã«è‰¯ã„ã“ã¨ãŒã‚ã‚Šã¾ã™" },
                { number: 7, fortune: "å‡¶", message: "æ…é‡ã«è¡Œå‹•ã—ã¾ã—ã‚‡ã†" },
                { number: 8, fortune: "å¤§å‰", message: "é¡˜ã„ãŒå¶ã†å…†ã—ã§ã™" },
                { number: 9, fortune: "ä¸­å‰", message: "äººã¨ã®å‡ºä¼šã„ã‚’å¤§åˆ‡ã«" },
                { number: 10, fortune: "å°å‰", message: "å¥åº·ã«æ°—ã‚’ã¤ã‘ã¦" },
                { number: 11, fortune: "å‰", message: "å®¶æ—ã¨ã®æ™‚é–“ã‚’å¤§åˆ‡ã«" },
                { number: 12, fortune: "åŠå‰", message: "å­¦ã³ã®æ©Ÿä¼šãŒè¨ªã‚Œã¾ã™" },
                { number: 13, fortune: "æœ«å‰", message: "å¿è€å¼·ãå–ã‚Šçµ„ã¿ã¾ã—ã‚‡ã†" },
                { number: 14, fortune: "å‡¶", message: "ä»Šã¯æº–å‚™ã®æ™‚ã§ã™" },
                { number: 15, fortune: "å¤§å‰", message: "æ–°ãŸãªé“ãŒé–‹ã‘ã¾ã™" },
                { number: 16, fortune: "ä¸­å‰", message: "å¿ƒã®å¹³å®‰ãŒå¾—ã‚‰ã‚Œã¾ã™" },
                { number: 17, fortune: "å°å‰", message: "æ€ã„ã‚„ã‚Šã®å¿ƒã‚’æŒã£ã¦" },
                { number: 18, fortune: "å‰", message: "è‡ªç„¶ã¨ã®èª¿å’Œã‚’å¤§åˆ‡ã«" },
                { number: 19, fortune: "åŠå‰", message: "æ„Ÿè¬ã®æ°—æŒã¡ã‚’å¿˜ã‚Œãšã«" },
                { number: 20, fortune: "æœ«å‰", message: "æ™‚ã‚’å¾…ã¤ã“ã¨ã‚‚å¤§åˆ‡ã§ã™" }
            ],
            rare: [
                { number: 21, fortune: "ğŸŒŸ ç‰¹å¤§å‰", message: "å¥‡è·¡çš„ãªå¹¸é‹ã«æµã¾ã‚Œã¾ã™ï¼\nä»æ§˜ã®ã”åŠ è­·ã‚’ã„ãŸã ã„ã¦ã„ã¾ã™" },
                { number: 22, fortune: "ğŸ™ æ³•ç¦", message: "åŠŸå¾³ã‚’ç©ã‚€æ©Ÿä¼šãŒè¨ªã‚Œã¾ã™\nä»–è€…ã¸ã®æ…ˆæ‚²ã®å¿ƒã‚’å¤§åˆ‡ã«" },
                { number: 23, fortune: "âœ¨ éœŠé¨“", message: "ã”å…ˆç¥–æ§˜ã®è¦‹å®ˆã‚Šã‚’æ„Ÿã˜ã‚‹æ™‚\nãŠå¢“å‚ã‚Šã‚’ãŠã™ã™ã‚ã—ã¾ã™" },
                { number: 24, fortune: "ğŸ›ï¸ å¯ºç¸", message: "ãŠå¯ºã¨ã®æ·±ã„ã”ç¸ã‚’æ„Ÿã˜ã‚‹æ™‚\nå¿ƒã®æ”¯ãˆãŒå¾—ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†" }
            ]
        };

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('errorMessage');
            
            if (input === correctPassword) {
                sessionStorage.setItem('omikuji_auth', 'true');
                errorMsg.classList.remove('show');
                showOmikujiScreen();
            } else {
                errorMsg.classList.add('show');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });

        function showOmikujiScreen() {
            document.getElementById('passwordScreen').classList.add('hidden');
            document.getElementById('omikujiScreen').classList.add('active');
        }

        function drawOmikuji() {
            const button = document.getElementById('drawBtn');
            const resultCard = document.getElementById('resultCard');
            
            button.disabled = true;
            button.classList.add('spinning');
            button.textContent = 'ğŸ”„ å¼•ã„ã¦ã„ã¾ã™...';
            resultCard.classList.remove('show');
            
            setTimeout(() => {
                let result;
                const randomValue = Math.random();
                
                if (randomValue < 0.05) {
                    const idx = Math.floor(Math.random() * omikujiResults.rare.length);
                    result = omikujiResults.rare[idx];
                } else {
                    const idx = Math.floor(Math.random() * omikujiResults.normal.length);
                    result = omikujiResults.normal[idx];
                }
                
                document.getElementById('resultNumber').textContent = `ç¬¬${result.number}ç•ª`;
                document.getElementById('resultFortune').textContent = result.fortune;
                document.getElementById('resultMessage').textContent = result.message;
                
                const fortuneElement = document.getElementById('resultFortune');
                if (result.number >= 21) {
                    fortuneElement.classList.add('rare');
                } else {
                    fortuneElement.classList.remove('rare');
                }
                
                resultCard.classList.add('show');
                button.classList.remove('spinning');
                button.disabled = false;
                button.textContent = 'ğŸ‹ ãŠã¿ãã˜ã‚’å¼•ã';
            }, 1500);
        }

        function resetOmikuji() {
            document.getElementById('resultCard').classList.remove('show');
        }

        function generateQR() {
            const url = document.getElementById('qrUrl').value.trim();
            const password = document.getElementById('qrPassword').value.trim();
            const templeName = document.getElementById('templeName').value.trim() || 'ç”Ÿé§’ã®ãŠå¯º';
            
            if (!url) {
                alert('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!password) {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }

            const qrUrl = `${url}${url.includes('?') ? '&' : '?'}pass=${encodeURIComponent(password)}`;
            generatedQrUrl = qrUrl;
            
            const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(qrUrl)}`;
            
            const qrImage = document.getElementById('qrImage');
            qrImage.src = qrImageUrl;
            qrImage.onload = function() {
                document.getElementById('displayTempleName').textContent = templeName;
                document.getElementById('displayPassword').textContent = password;
                document.getElementById('displayUrl').textContent = qrUrl;
                document.getElementById('qrResult').classList.add('show');
                document.getElementById('successMessage').classList.add('show');
                
                setTimeout(() => {
                    document.getElementById('successMessage').classList.remove('show');
                }, 3000);
                
                document.getElementById('qrResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            };
            
            qrImage.onerror = function() {
                alert('QRã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            };
        }

        function downloadQR() {
            const qrImage = document.getElementById('qrImage');
            if (!qrImage.src) {
                alert('å…ˆã«QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„');
                return;
            }
            
            const link = document.createElement('a');
            link.href = qrImage.src;
            link.download = 'omikuji_qrcode.png';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyUrl() {
            if (!generatedQrUrl) {
                alert('å…ˆã«QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„');
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = generatedQrUrl;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                alert('âœ… URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\n' + generatedQrUrl);
            } catch (err) {
                prompt('ä»¥ä¸‹ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„:', generatedQrUrl);
            }
            
            document.body.removeChild(textarea);
        }

        if (sessionStorage.getItem('omikuji_auth') === 'true') {
            showOmikujiScreen();
        }
    </script>
</body>
</html>

