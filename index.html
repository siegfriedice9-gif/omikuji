<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パスワード付き無料おみくじ - 生駒のお寺</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #f5f3f0 0%, #e8e2d9 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .password-screen { display: block; }
        .password-screen.hidden { display: none; }
        .lock-icon { font-size: 72px; margin-bottom: 20px; }
        .password-title {
            color: #8b4513;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .password-desc { color: #666; font-size: 14px; margin-bottom: 30px; }
        .password-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 5px;
            margin-bottom: 20px;
        }
        .password-input:focus {
            outline: none;
            border-color: #8b4513;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.2);
        }
        .password-btn {
            background: linear-gradient(45deg, #d4af37, #ffd700);
            color: #8b4513;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        .password-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }
        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        .error-message.show { display: block; }
        .omikuji-screen { display: none; }
        .omikuji-screen.active { display: block; }
        .temple-header { margin-bottom: 30px; }
        .temple-title {
            color: #8b4513;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .temple-subtitle { color: #666; font-size: 14px; }
        .instructions {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        .omikuji-box {
            background: linear-gradient(135deg, #8b4513 0%, #a0541a 100%);
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 30px;
        }
        .omikuji-button {
            background: linear-gradient(45deg, #d4af37, #ffd700);
            color: #8b4513;
            border: none;
            padding: 18px 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease;
        }
        .omikuji-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.6);
        }
        .omikuji-button:disabled { opacity: 0.6; cursor: not-allowed; }
        .result-section {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        .result-card {
            background: linear-gradient(135deg, #fff 0%, #f8f6f3 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            display: none;
            animation: fadeInScale 0.6s ease-out;
        }
        .result-card.show { display: block; }
        .result-number {
            font-size: 18px;
            color: #8b4513;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .result-fortune {
            font-size: 36px;
            font-weight: bold;
            color: #8b4513;
            margin-bottom: 15px;
        }
        .result-fortune.rare {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .result-message {
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        .reset-btn {
            background: #8b4513;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .reset-btn:hover {
            background: #a0541a;
            transform: translateY(-2px);
        }
        .qr-generator {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #d4af37;
        }
        .qr-generator-title {
            color: #8b4513;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .qr-settings {
            text-align: left;
            margin-bottom: 20px;
        }
        .qr-setting-group { margin-bottom: 15px; }
        .qr-label {
            display: block;
            color: #8b4513;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .qr-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #d4af37;
            border-radius: 5px;
            font-size: 14px;
        }
        .qr-input:focus { outline: none; border-color: #8b4513; }
        .qr-generate-btn {
            background: linear-gradient(45deg, #8b4513, #a0541a);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .qr-generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        .qr-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        .qr-result.show { display: block; }
        .qr-image-container {
            margin: 20px 0;
            padding: 15px;
            background: #f8f6f3;
            border-radius: 10px;
        }
        .qr-image-container img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .qr-details {
            background: #f8f6f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: left;
            font-size: 13px;
            color: #666;
            line-height: 1.8;
        }
        .qr-details strong { color: #8b4513; }
        .qr-url-display {
            background: #fff9e6;
            padding: 10px;
            border-radius: 5px;
            border: 1px dashed #d4af37;
            word-break: break-all;
            font-size: 12px;
            color: #666;
            margin: 10px 0;
        }
        .qr-action-btns {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .qr-action-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        .qr-action-btn:hover {
            background: #45b8b0;
            transform: translateY(-2px);
        }
        .qr-action-btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        }
        .qr-action-btn.primary:hover {
            background: linear-gradient(45deg, #ff5252, #ff7575);
        }
        .qr-info {
            background: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d4af37;
            font-size: 12px;
            color: #666;
            text-align: left;
            line-height: 1.6;
            margin-top: 15px;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            border-left: 4px solid #28a745;
            display: none;
        }
        .success-message.show { display: block; }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .spinning { animation: spin 1s ease-in-out; }
        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="passwordScreen" class="password-screen">
            <div class="lock-icon">🔒</div>
            <h1 class="password-title">パスワード入力</h1>
            <p class="password-desc">このおみくじは檀家様専用です<br>パスワードを入力してください</p>
            <input type="password" id="passwordInput" class="password-input" placeholder="パスワード" maxlength="10">
            <button class="password-btn" onclick="checkPassword()">🔓 ログイン</button>
            <div id="errorMessage" class="error-message">パスワードが間違っています</div>
        </div>

        <div id="omikujiScreen" class="omikuji-screen">
            <div class="temple-header">
                <h1 class="temple-title">🎋 無料おみくじ</h1>
                <p class="temple-subtitle">生駒のお寺（檀家様専用）</p>
            </div>
            
            <div class="instructions">
                <p>📱 何度でも無料でお引きいただけます<br>心を落ち着けてボタンを押してください</p>
            </div>
            
            <div class="omikuji-box">
                <button class="omikuji-button" id="drawBtn" onclick="drawOmikuji()">
                    🎋 おみくじを引く
                </button>
            </div>
            
            <div class="result-section">
                <div class="result-card" id="resultCard">
                    <div class="result-number" id="resultNumber">第○番</div>
                    <div class="result-fortune" id="resultFortune">大吉</div>
                    <div class="result-message" id="resultMessage">運勢メッセージ</div>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed #d4af37;">
                        <button class="reset-btn" onclick="resetOmikuji()">もう一度引く</button>
                    </div>
                </div>
            </div>

            <div class="qr-generator">
                <h2 class="qr-generator-title">📱 QRコード生成（管理者用）</h2>
                
                <div class="qr-settings">
                    <div class="qr-setting-group">
                        <label class="qr-label">おみくじページURL:</label>
                        <input type="text" id="qrUrl" class="qr-input" placeholder="https://あなたのサイト.com/omikuji.html" value="https://example.com/omikuji.html">
                    </div>
                    
                    <div class="qr-setting-group">
                        <label class="qr-label">設定するパスワード:</label>
                        <input type="text" id="qrPassword" class="qr-input" placeholder="例: danka2024" value="1234">
                    </div>

                    <div class="qr-setting-group">
                        <label class="qr-label">寺院名（表示用）:</label>
                        <input type="text" id="templeName" class="qr-input" value="生駒のお寺">
                    </div>
                </div>
                
                <button class="qr-generate-btn" onclick="generateQR()">🔍 QRコード生成</button>
                
                <div id="qrResult" class="qr-result">
                    <div id="successMessage" class="success-message">
                        ✅ QRコードを生成しました！
                    </div>
                    
                    <div class="qr-image-container">
                        <img id="qrImage" alt="QRコード">
                    </div>
                    
                    <div class="qr-details">
                        <strong>📋 生成されたQRコード情報：</strong><br>
                        寺院名: <span id="displayTempleName"></span><br>
                        パスワード: <span id="displayPassword"></span><br><br>
                        <strong>完全なURL:</strong>
                    </div>
                    <div class="qr-url-display" id="displayUrl"></div>
                    
                    <div class="qr-action-btns">
                        <button class="qr-action-btn primary" onclick="downloadQR()">
                            📥 QRコード画像をダウンロード
                        </button>
                        <button class="qr-action-btn" onclick="copyUrl()">
                            📋 URLをコピー
                        </button>
                    </div>
                </div>

                <div class="qr-info">
                    <strong>💡 使い方：</strong><br>
                    1. 上記の項目を入力<br>
                    2. 「QRコード生成」をクリック<br>
                    3. QRコード画像が表示されます<br>
                    4. 「QRコード画像をダウンロード」をクリック<br>
                    5. または画像を右クリック→「名前を付けて画像を保存」<br>
                    6. 印刷して境内に設置<br><br>
                    <strong>※ QRコードには自動的にパスワード情報が埋め込まれます</strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        let correctPassword = '1234';
        let generatedQrUrl = '';

        const omikujiResults = {
            normal: [
                { number: 1, fortune: "大吉", message: "素晴らしい一日となるでしょう" },
                { number: 2, fortune: "中吉", message: "良いご縁に恵まれます" },
                { number: 3, fortune: "小吉", message: "小さな幸せが訪れます" },
                { number: 4, fortune: "吉", message: "穏やかな日々が続きます" },
                { number: 5, fortune: "半吉", message: "努力が実を結ぶでしょう" },
                { number: 6, fortune: "末吉", message: "後に良いことがあります" },
                { number: 7, fortune: "凶", message: "慎重に行動しましょう" },
                { number: 8, fortune: "大吉", message: "願いが叶う兆しです" },
                { number: 9, fortune: "中吉", message: "人との出会いを大切に" },
                { number: 10, fortune: "小吉", message: "健康に気をつけて" },
                { number: 11, fortune: "吉", message: "家族との時間を大切に" },
                { number: 12, fortune: "半吉", message: "学びの機会が訪れます" },
                { number: 13, fortune: "末吉", message: "忍耐強く取り組みましょう" },
                { number: 14, fortune: "凶", message: "今は準備の時です" },
                { number: 15, fortune: "大吉", message: "新たな道が開けます" },
                { number: 16, fortune: "中吉", message: "心の平安が得られます" },
                { number: 17, fortune: "小吉", message: "思いやりの心を持って" },
                { number: 18, fortune: "吉", message: "自然との調和を大切に" },
                { number: 19, fortune: "半吉", message: "感謝の気持ちを忘れずに" },
                { number: 20, fortune: "末吉", message: "時を待つことも大切です" }
            ],
            rare: [
                { number: 21, fortune: "🌟 特大吉", message: "奇跡的な幸運に恵まれます！\n仏様のご加護をいただいています" },
                { number: 22, fortune: "🙏 法福", message: "功徳を積む機会が訪れます\n他者への慈悲の心を大切に" },
                { number: 23, fortune: "✨ 霊験", message: "ご先祖様の見守りを感じる時\nお墓参りをおすすめします" },
                { number: 24, fortune: "🏛️ 寺縁", message: "お寺との深いご縁を感じる時\n心の支えが得られるでしょう" }
            ]
        };

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('errorMessage');
            
            if (input === correctPassword) {
                sessionStorage.setItem('omikuji_auth', 'true');
                errorMsg.classList.remove('show');
                showOmikujiScreen();
            } else {
                errorMsg.classList.add('show');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });

        function showOmikujiScreen() {
            document.getElementById('passwordScreen').classList.add('hidden');
            document.getElementById('omikujiScreen').classList.add('active');
        }

        function drawOmikuji() {
            const button = document.getElementById('drawBtn');
            const resultCard = document.getElementById('resultCard');
            
            button.disabled = true;
            button.classList.add('spinning');
            button.textContent = '🔄 引いています...';
            resultCard.classList.remove('show');
            
            setTimeout(() => {
                let result;
                const randomValue = Math.random();
                
                if (randomValue < 0.05) {
                    const idx = Math.floor(Math.random() * omikujiResults.rare.length);
                    result = omikujiResults.rare[idx];
                } else {
                    const idx = Math.floor(Math.random() * omikujiResults.normal.length);
                    result = omikujiResults.normal[idx];
                }
                
                document.getElementById('resultNumber').textContent = `第${result.number}番`;
                document.getElementById('resultFortune').textContent = result.fortune;
                document.getElementById('resultMessage').textContent = result.message;
                
                const fortuneElement = document.getElementById('resultFortune');
                if (result.number >= 21) {
                    fortuneElement.classList.add('rare');
                } else {
                    fortuneElement.classList.remove('rare');
                }
                
                resultCard.classList.add('show');
                button.classList.remove('spinning');
                button.disabled = false;
                button.textContent = '🎋 おみくじを引く';
            }, 1500);
        }

        function resetOmikuji() {
            document.getElementById('resultCard').classList.remove('show');
        }

        function generateQR() {
            const url = document.getElementById('qrUrl').value.trim();
            const password = document.getElementById('qrPassword').value.trim();
            const templeName = document.getElementById('templeName').value.trim() || '生駒のお寺';
            
            if (!url) {
                alert('URLを入力してください');
                return;
            }
            
            if (!password) {
                alert('パスワードを設定してください');
                return;
            }

            const qrUrl = `${url}${url.includes('?') ? '&' : '?'}pass=${encodeURIComponent(password)}`;
            generatedQrUrl = qrUrl;
            
            const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(qrUrl)}`;
            
            const qrImage = document.getElementById('qrImage');
            qrImage.src = qrImageUrl;
            qrImage.onload = function() {
                document.getElementById('displayTempleName').textContent = templeName;
                document.getElementById('displayPassword').textContent = password;
                document.getElementById('displayUrl').textContent = qrUrl;
                document.getElementById('qrResult').classList.add('show');
                document.getElementById('successMessage').classList.add('show');
                
                setTimeout(() => {
                    document.getElementById('successMessage').classList.remove('show');
                }, 3000);
                
                document.getElementById('qrResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            };
            
            qrImage.onerror = function() {
                alert('QRコードの生成に失敗しました。インターネット接続を確認してください。');
            };
        }

        function downloadQR() {
            const qrImage = document.getElementById('qrImage');
            if (!qrImage.src) {
                alert('先にQRコードを生成してください');
                return;
            }
            
            const link = document.createElement('a');
            link.href = qrImage.src;
            link.download = 'omikuji_qrcode.png';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyUrl() {
            if (!generatedQrUrl) {
                alert('先にQRコードを生成してください');
                return;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = generatedQrUrl;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                alert('✅ URLをコピーしました！\n\n' + generatedQrUrl);
            } catch (err) {
                prompt('以下のURLをコピーしてください:', generatedQrUrl);
            }
            
            document.body.removeChild(textarea);
        }

        if (sessionStorage.getItem('omikuji_auth') === 'true') {
            showOmikujiScreen();
        }
    </script>
</body>
</html>

